<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Björklunds Rapport - Mobiloptimerad</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#344a34">
    <link rel="apple-touch-icon" href="icon-192x192.png">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrious/4.0.2/qrious.min.js"></script>
    <style>
        :root { /* ... (CSS-variabler oförändrade) ... */ }
        body[data-theme="dark"] { /* ... (CSS-variabler oförändrade) ... */ }
        *, *::before, *::after { box-sizing: border-box; }
        body { /* ... (Grundläggande body-stil oförändrad) ... */ }
        body.overlay-open { overflow: hidden; }
        .container { /* ... (Container-stil oförändrad) ... */ }
        .app-header-actions-left { /* ... (oförändrad) ... */ }
        .app-header-actions {  /* ... (oförändrad) ... */ }
        /* ... (Resten av grundläggande CSS för knappar, inputs, ikoner etc. är oförändrad) ... */
        /* ... (Behåll all CSS från din fungerande version fram till Report List styling) ... */
        
        h1, h2, h3 {
            color: var(--primary-color); 
            text-align: center;
            margin-top: 0; 
        }
        h1 { margin-bottom: 20px; font-size: 1.7em; }
        h2 { margin-bottom: 15px; font-size: 1.4em; margin-top: 25px; border-bottom: 1px solid var(--border-color); padding-bottom: 8px;}
        
        hr { border: 0; height: 1px; background-color: var(--border-color); margin: 25px 0; }
        .info-text { color: var(--secondary-text-color); font-size: 0.9em; text-align: center; margin-top: 10px; }

        button, .button-like {
            padding: 10px 15px; background-color: var(--primary-color); color: var(--primary-text-color); border: none;
            border-radius: 4px; cursor: pointer; font-size: 1em; font-family: 'Georgia', serif;
            transition: background-color 0.3s ease, color 0.3s ease; text-align: center; text-decoration: none;
            display: inline-flex; align-items: center; justify-content: center; height: 40px;
            box-sizing: border-box; flex-shrink: 0;
        }
        button:hover, .button-like:hover { background-color: color-mix(in srgb, var(--primary-color) 85%, black); }
        button:disabled { background-color: var(--secondary-text-color); cursor: not-allowed; opacity: 0.7;}
        .button-secondary {
            background-color: var(--secondary-button-bg-color); color: var(--secondary-button-text-color);
            border: 1px solid var(--secondary-button-border-color);
        }
        .button-secondary:hover { background-color: color-mix(in srgb, var(--secondary-button-bg-color) 90%, black 10%);}
        #clearAllDataBtn {
            background-color: var(--danger-secondary-bg) !important; color: var(--danger-secondary-text-color) !important;
            border-color: var(--danger-color) !important;
        }
        #clearAllDataBtn:hover { background-color: color-mix(in srgb, var(--danger-secondary-bg) 80%, black 20%) !important; }
        input[type="text"], input[type="time"], select {
            flex-grow: 1; padding: 10px; border: 1px solid var(--border-color); border-radius: 4px;
            font-size: 1em; height: 40px; box-sizing: border-box; background-color: var(--surface-bg-color);
            color: var(--text-color); min-width: 150px;
        }
        input[type="checkbox"] { width: 18px; height: 18px; margin-right: 8px; flex-shrink: 0;}
        .icon-button {
            background: transparent; border: none; padding: 8px; cursor: pointer; display: inline-flex;
            align-items: center; justify-content: center; width: 40px; height: 40px;
        }
        .icon-button svg { width: 20px; height: 20px; fill: var(--icon-fill-color); transition: fill 0.2s ease; }
        .icon-button:hover svg { fill: var(--icon-hover-fill-color); }
        .icon-button:disabled svg { fill: var(--secondary-text-color) !important; opacity: 0.5; }
        .app-header-actions-left .icon-button, .app-header-actions .icon-button { width: 28px; height: 28px; padding: 4px;}
        .app-header-actions-left .icon-button svg, .app-header-actions .icon-button svg { width: 20px; height: 20px;}
        .delete-btn svg { fill: var(--danger-color) !important; }
        .delete-btn:hover svg { fill: color-mix(in srgb, var(--danger-color) 80%, black) !important; }
        .add-game-btn svg, .edit-game-btn svg { fill: var(--primary-color) !important; }
        .add-game-btn:hover svg, .edit-game-btn:hover svg { fill: var(--icon-hover-fill-color) !important; }
        .add-game-btn, .edit-game-btn { padding: 4px; }
        .speech-button { border: 1px solid var(--secondary-button-border-color); background-color: var(--secondary-button-bg-color); }
        .speech-button svg { fill: var(--secondary-button-text-color) !important; }
        .speech-button:hover { background-color: color-mix(in srgb, var(--secondary-button-bg-color) 90%, black 10%); }
        .speech-button.is-listening svg { fill: var(--listening-color) !important; }
        .input-group, .form-group { display: flex; margin-bottom: 15px; gap: 10px; align-items: center; flex-wrap: wrap;}
        .form-group { flex-direction: column; align-items: stretch; gap: 5px;}
        .form-group label { font-weight: bold; margin-bottom: 2px; font-size: 0.9em;}
        #shotLogList { list-style-type: none; padding: 0; margin: 15px 0 0 0; }
        .shot-log-item { display: flex; justify-content: space-between; align-items: center; padding: 8px 5px; border-bottom: 1px solid var(--subtle-border-color); font-size: 0.95em; }
        .shot-log-item:last-child { border-bottom: none; }
        .shot-log-item .time-verified-group { display: flex; align-items: center; gap: 10px; }
        .shot-log-item .time-verified-group label { font-size: 0.9em; color: var(--secondary-text-color); }
        .shot-log-item span {  flex-grow: 1; }
        .shot-log-item .actions .icon-button, .shot-log-item .actions .icon-button svg { width: 28px; height: 28px; padding: 2px;}
        .shot-log-item .actions .icon-button svg { width: 16px; height: 16px;}


        /* --- NY STYLING FÖR RAPPORTLISTA (Fällt Vilt) --- */
        #reportList { /* Detta är nu containern för alla rapport-items */
            list-style-type: none;
            padding: 0;
            margin: 0;
        }

        .report-item-wrapper { /* Nytt omslag för varje rapport (primär + sekundär info) */
            border-bottom: 1px solid var(--subtle-border-color);
            padding: 10px 0;
        }
        .report-item-wrapper:last-child {
            border-bottom: none;
        }

        .report-primary-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 10px;
        }

        .report-primary-info .species-shooter {
            flex-grow: 1; /* Tar upp mest plats */
            display: flex;
            flex-direction: column; /* Viltslag över Skytt */
        }
        .report-primary-info .species {
            font-weight: bold;
            font-size: 1em;
            color: var(--text-color);
            word-break: break-word;
        }
        .report-primary-info .shooter {
            font-size: 0.85em;
            color: var(--secondary-text-color);
            word-break: break-word;
        }

        .report-primary-info .actions-and-toggle {
            display: flex;
            align-items: center;
            gap: 5px;
            flex-shrink: 0; /* Förhindra att denna del krymper för mycket */
        }
        .report-primary-info .actions-and-toggle .item-actions .icon-button {
             padding: 4px; width: 28px; height: 28px;
        }
        .report-primary-info .actions-and-toggle .item-actions .icon-button svg{
            width: 16px; height: 16px;
        }


        .toggle-details-btn {
            background: transparent;
            border: none;
            padding: 5px;
            cursor: pointer;
            margin-left: 5px; /* Lite space från action-knapparna */
        }
        .toggle-details-btn svg {
            width: 18px;
            height: 18px;
            fill: var(--icon-fill-color);
            transition: transform 0.3s ease;
        }
        .toggle-details-btn.expanded svg {
            transform: rotate(180deg);
        }

        .report-secondary-info {
            display: none; /* Dold by default */
            padding: 8px 5px 5px 15px; /* Indrag för sekundär info */
            font-size: 0.85em;
            background-color: color-mix(in srgb, var(--surface-bg-color) 97%, var(--bg-color));
            border-top: 1px dashed var(--subtle-border-color);
            margin-top: 8px;
        }
        .report-secondary-info.visible {
            display: block;
        }
        .report-secondary-info p {
            margin: 3px 0;
        }
        .report-secondary-info strong {
            color: var(--primary-color);
            min-width: 100px; /* För justering */
            display: inline-block;
        }
        
        /* Full tabell-layout för bredare skärmar */
        /* Denna media query bör vara bredare än den förra för att "vinna" */
        @media (min-width: 700px) { 
            .report-item-wrapper { /* Återställ padding för full bredd */
                padding: 0;
            }
            /* Dölj den mobila expander-knappen */
            .report-primary-info .actions-and-toggle .toggle-details-btn {
                display: none;
            }
            /* Visa sekundär info direkt */
            .report-secondary-info {
                display: none !important; /* Dölj den helt, vi använder grid-cellerna */
            }

            #felledGameReportSection .report-table-header, /* Återanvänd gamla klasser för header */
            #felledGameReportSection .report-primary-info { /* Gör om primär info till en grid-rad */
                display: grid;
                grid-template-columns: 2fr 1fr 1.5fr 1.5fr 2fr 0.8fr; 
                gap: 8px; 
                padding: 10px 5px;
                border-bottom: 1px solid var(--subtle-border-color); /* Behåll bottenlinjen */
                align-items: center;
                font-size: 0.9em; /* Återställ fontstorlek */
            }
             #felledGameReportSection .report-primary-info:last-child { /* För sista raden */
                 border-bottom: none;
             }


            #felledGameReportSection .report-table-header {
                font-weight: bold;
                color: var(--primary-color);
                background-color: color-mix(in srgb, var(--surface-bg-color) 90%, var(--bg-color) 10%);
                border-top-left-radius: 4px;
                border-top-right-radius: 4px;
                margin-top: 5px;
                padding: 12px 5px;
            }
            #felledGameReportSection .report-table-header div { /* Header celler */
                 overflow: hidden; text-overflow: ellipsis; white-space: nowrap;
            }
            
            /* Anpassa cellerna i .report-primary-info för grid */
            .report-primary-info .species-shooter { /* Detta blir nu "Viltslag"-cellen */
                flex-direction: row; /* Återställ om det påverkade */
                align-items: center; /* Centrera om det finns både species och shooter (fast vi delar upp dem) */
            }
             /* Skapa nya element eller återanvänd för grid-celler */
            .report-primary-info .species,
            .report-primary-info .shot-time-cell, /* Nytt för grid */
            .report-primary-info .shooter,
            .report-primary-info .pass-location-cell, /* Nytt för grid */
            .report-primary-info .meat-dist-cell, /* Nytt för grid */
            .report-primary-info .actions-and-toggle { /* Åtgärder blir sista cellen */
                overflow: hidden; text-overflow: ellipsis; white-space: nowrap;
                 font-size: inherit; /* Ärver från .report-primary-info */
            }
            .report-primary-info .meat-dist-cell,
            .report-primary-info .species {
                 white-space: normal; word-break: break-word;
            }
            .report-primary-info .actions-and-toggle {
                justify-content: flex-end;
            }
             .report-primary-info .actions-and-toggle .item-actions {
                 display: flex; /* Säkerställ att knapparna är på rad */
                 gap: 4px;
             }
        }

        /* Overlays etc. (oförändrad styling) */
        .content-overlay { /* ... (oförändrad) ... */ }
        /* ... (resten av din fungerande CSS) ... */

    </style>
</head>
<body>
    <!-- ... (HTML för .container, header-actions, quickShotEntrySection är oförändrad) ... -->
    <div class="container">
        <div class="app-header-actions-left">
            <button id="themeToggleBtn" class="icon-button" title="Växla tema">
                <svg id="themeIconMoon" viewBox="0 0 24 24" style="display: none;"><path d="M12 1.993C11.419 1.993 10.847 2.022 10.285 2.076C5.262 2.58 1.993 6.832 1.993 11.999C1.993 17.635 6.365 22 11.999 22C16.957 22 21.145 18.053 21.904 13.269C21.951 12.989 21.979 12.705 21.993 12.416C21.964 12.393 21.938 12.372 21.911 12.353C16.334 11.653 12.707 7.586 12.085 1.993H12Z"/></svg>
                <svg id="themeIconSun" viewBox="0 0 16 16" style="display: block;"><path d="M8 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"/></svg>
            </button>
        </div>

        <div class="app-header-actions">
            <button id="helpBtn" class="icon-button" title="Hjälp"><svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8s8 3.59 8 8-3.59 8-8 8zm-1-5h2v2h-2v-2zm0-8h2v6h-2V7z"/></svg></button>
            <button id="shareBtn" class="icon-button" title="Dela appen"><svg viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 8.81C7.5 8.31 6.79 8 6 8c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.66 1.34 3 3 3s3-1.34 3-3-1.34-3-3-3z"/></svg></button>
            <button id="installAppBtn" class="icon-button" title="Installera appen" style="display: none;"><svg viewBox="0 0 24 24"><path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"/></svg></button>
        </div>

        <h1>Björklunds Rapport</h1>

        <section id="quickShotEntrySection">
            <h2>Snabbregistrera Skott</h2>
            <button id="logShotBtn" style="width:100%; font-size: 1.1em; padding: 12px;">Avlossat Skott Nu</button>
            
            <ul id="shotLogList">
                <!-- Loggade skott listas här -->
            </ul>
            <p id="noLoggedShotsInfo" class="info-text" style="display: block;">Inga skott loggade ännu.</p>
        </section>

        <hr>

        <section id="felledGameReportSection">
            <h2>Rapportlista (Fällt Vilt)</h2>
            <div id="reportList"> 
                <!-- Header och rapport-rader (med fällda vilt) kommer renderas här av JS -->
            </div>
            <p id="noReportsInfo" class="info-text" style="display: block;">Inga fällda vilt rapporterade ännu.</p>
        </section>
        
        <div class="bottom-actions">
            <button id="exportDataBtn" class="button-secondary">Exportera Data (CSV)</button>
            <button id="clearAllDataBtn" class="button-secondary">Rensa All Data</button>
        </div>
    </div> 

    <!-- Modal och andra overlays (HTML oförändrad) -->
    <!-- ... (klistra in HTML för addGameModal, helpOverlay, shareOverlay här) ... -->
    <div id="addGameModal" class="content-overlay" style="display: none;"> <!-- ... (samma som tidigare) ... --> </div>
    <div id="helpOverlay" class="content-overlay" style="display: none;"> <!-- ... (samma som tidigare) ... --> </div>
    <div id="shareOverlay" class="content-overlay" style="display: none;"> <!-- ... (samma som tidigare) ... --> </div>


    <script>
        // --- DOM ELEMENT REFERENSER (samma som tidigare) ---
        // ... (alla dina let-variabler för DOM-element) ...
        let themeToggleBtn, themeIconSun, themeIconMoon, helpBtn, shareBtn, installAppBtn,
            logShotBtn, shotLogList, noLoggedShotsInfo, 
            reportListContainer, 
            noReportsInfo, 
            exportDataBtn, clearAllDataBtn, 
            addGameModal, gameModalTitle, currentShotLogIdInput, 
            gameSpeciesInput, gamePassLocationInput,
            gameShooterInput, speakShooterBtn, gameMeatDistributionInput, speakMeatBtn,
            saveGameDetailsBtn, cancelGameModalBtn,
            helpOverlay, helpOverlayCloseBtn, shareOverlay, shareOverlayCloseBtn, qrCodeContainer, shareableLink;


        // --- GLOBALA VARIABLER (samma som tidigare) ---
        // ... (allReports, currentTheme, deferredPrompt, etc.) ...
        let allReports = []; 
        let currentTheme = localStorage.getItem('theme') || (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
        let deferredPrompt;
        const appURL = window.location.href; 
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        let shooterRecognition, meatRecognition;
        let activeRecognitionInput = null; 

        // --- INITIERING VID LADDNING AV SIDAN (samma som tidigare) ---
        document.addEventListener('DOMContentLoaded', () => {
             // ... (DOM-element tilldelningar och grundläggande event listeners) ...
            themeToggleBtn = document.getElementById('themeToggleBtn'); // etc. för alla element
            themeIconSun = document.getElementById('themeIconSun');
            themeIconMoon = document.getElementById('themeIconMoon');
            helpBtn = document.getElementById('helpBtn');
            shareBtn = document.getElementById('shareBtn');
            installAppBtn = document.getElementById('installAppBtn');
            logShotBtn = document.getElementById('logShotBtn');
            shotLogList = document.getElementById('shotLogList');
            noLoggedShotsInfo = document.getElementById('noLoggedShotsInfo');
            reportListContainer = document.getElementById('reportList'); 
            noReportsInfo = document.getElementById('noReportsInfo');
            exportDataBtn = document.getElementById('exportDataBtn');
            clearAllDataBtn = document.getElementById('clearAllDataBtn');
            addGameModal = document.getElementById('addGameModal');
            gameModalTitle = document.getElementById('gameModalTitle');
            currentShotLogIdInput = document.getElementById('currentShotLogIdInput');
            gameSpeciesInput = document.getElementById('gameSpeciesInput');
            gamePassLocationInput = document.getElementById('gamePassLocationInput');
            gameShooterInput = document.getElementById('gameShooterInput');
            speakShooterBtn = document.getElementById('speakShooterBtn');
            gameMeatDistributionInput = document.getElementById('gameMeatDistributionInput');
            speakMeatBtn = document.getElementById('speakMeatBtn');
            saveGameDetailsBtn = document.getElementById('saveGameDetailsBtn');
            cancelGameModalBtn = document.getElementById('cancelGameModalBtn');
            helpOverlay = document.getElementById('helpOverlay');
            helpOverlayCloseBtn = document.getElementById('helpOverlayCloseBtn');
            shareOverlay = document.getElementById('shareOverlay');
            shareOverlayCloseBtn = document.getElementById('shareOverlayCloseBtn');
            qrCodeContainer = document.getElementById('qrCodeContainer');
            shareableLink = document.getElementById('shareableLink');

            if (installAppBtn) installAppBtn.style.display = 'none';
            applyTheme(currentTheme);
            loadAllDataFromLocalStorage(); 
            renderShotLogList();
            renderFelledGameReportList();

            if (themeToggleBtn) themeToggleBtn.addEventListener('click', toggleTheme);
            if (helpBtn) helpBtn.addEventListener('click', openHelpOverlay);
            if (shareBtn) shareBtn.addEventListener('click', openShareOverlay);
            if (logShotBtn) logShotBtn.addEventListener('click', handleLogShot);
            if (exportDataBtn) exportDataBtn.addEventListener('click', exportAllDataToCSV);
            if (clearAllDataBtn) clearAllDataBtn.addEventListener('click', handleClearAllData);
            if (saveGameDetailsBtn) saveGameDetailsBtn.addEventListener('click', handleSaveGameDetails);
            if (cancelGameModalBtn) cancelGameModalBtn.addEventListener('click', closeAddGameModal);
            if (helpOverlayCloseBtn) helpOverlayCloseBtn.addEventListener('click', closeHelpOverlay);
            if (shareOverlayCloseBtn) shareOverlayCloseBtn.addEventListener('click', closeShareOverlay);
            
            setupSpeechRecognitionForShooter();
            setupSpeechRecognitionForMeat();
            setupPWAInstallation();

            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('sw.js')
                    .then(registration => console.log('SW registered scope:', registration.scope))
                    .catch(error => console.log('SW registration failed:', error));
            }
        });

        // --- TEMA & PWA (oförändrade) ---
        function applyTheme(theme) { /* ... (din befintliga korrekta funktion) ... */ }
        function toggleTheme() { /* ... (din befintliga korrekta funktion) ... */ }
        function setupPWAInstallation() { /* ... (din befintliga korrekta funktion) ... */ }
        
        // --- SPEECH RECOGNITION (oförändrade) ---
        function setupGenericSpeechRecognition(recognitionInstance, buttonElement, targetInputElement) { /* ... (din befintliga korrekta funktion) ... */ }
        function setupSpeechRecognitionForShooter() { /* ... (din befintliga korrekta funktion) ... */ }
        function setupSpeechRecognitionForMeat() { /* ... (din befintliga korrekta funktion) ... */ }

        // --- DATASTRUKTUR & LAGRING (oförändrade) ---
        function saveAllDataToLocalStorage() { /* ... (din befintliga korrekta funktion) ... */ }
        function loadAllDataFromLocalStorage() { /* ... (din befintliga korrekta funktion) ... */ }
        
        // --- SNABBREC SKOTT (oförändrade) ---
        function handleLogShot() { /* ... (din befintliga korrekta funktion) ... */ }
        function handleToggleShotVerification(shotId, checkboxElement) { /* ... (din befintliga korrekta funktion) ... */ }
        function handleDeleteLoggedShot(shotId) { /* ... (din befintliga korrekta funktion) ... */ }
        function renderShotLogList() { /* ... (din befintliga korrekta funktion) ... */ }
        
        // --- RAPPORTLISTA FÖR FÄLLT VILT (Nytt för expanderbar info) ---
        function renderFelledGameReportList() {
            if (!reportListContainer || !noReportsInfo) return;
            reportListContainer.innerHTML = ''; 

            const reportsWithGame = allReports
                .filter(report => report.felledGameDetails)
                .sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt)); // Nyast först

            if (reportsWithGame.length === 0) {
                noReportsInfo.style.display = 'block';
                const existingHeader = reportListContainer.querySelector('.report-table-header'); // För full bredd
                if (existingHeader) existingHeader.remove();
            } else {
                noReportsInfo.style.display = 'none';

                // Header för fullbreddsvy (visas/döljs med CSS @media)
                const fullHeaderRow = document.createElement('div');
                fullHeaderRow.classList.add('report-table-header'); // Använd samma klass för styling
                ["Viltslag", "Tid", "Skytt", "Pass", "Köttfördelning", "Åtgärd"].forEach((text, index) => {
                    const headerCell = document.createElement('div');
                    const colClasses = ["col-vilt", "col-tid", "col-skytt", "col-pass", "col-kott", "col-actions"];
                    if (colClasses[index]) headerCell.classList.add(colClasses[index]);
                    headerCell.textContent = text;
                    fullHeaderRow.appendChild(headerCell);
                });
                reportListContainer.appendChild(fullHeaderRow);


                reportsWithGame.forEach(report => {
                    const wrapper = document.createElement('div');
                    wrapper.classList.add('report-item-wrapper');
                    wrapper.dataset.reportId = report.id;

                    // Primär info (alltid synlig i mobilvy, blir celler i desktop)
                    const primaryInfoDiv = document.createElement('div');
                    primaryInfoDiv.classList.add('report-primary-info');

                    // Viltslag och Skytt (kombinerad i mobil, separata celler i desktop)
                    const speciesShooterDiv = document.createElement('div');
                    speciesShooterDiv.classList.add('species-shooter'); // Mobil-layout
                    
                    const speciesSpan = document.createElement('span'); // Blir .species i desktop
                    speciesSpan.classList.add('species');
                    speciesSpan.textContent = report.felledGameDetails.species || '-';
                    
                    const shooterSpan = document.createElement('span'); // Blir .shooter i desktop
                    shooterSpan.classList.add('shooter');
                    shooterSpan.textContent = report.felledGameDetails.shooter ? `Skytt: ${report.felledGameDetails.shooter}` : 'Skytt: -';
                    
                    speciesShooterDiv.appendChild(speciesSpan);
                    speciesShooterDiv.appendChild(shooterSpan);
                    primaryInfoDiv.appendChild(speciesShooterDiv);

                    // Skapa celler för desktop-vy (dolda i mobil om de inte är species/shooter/actions)
                    const timeCellDesktop = document.createElement('div');
                    timeCellDesktop.classList.add('report-cell', 'shot-time-cell'); // För desktop grid
                    timeCellDesktop.textContent = report.shotTime || '-';
                     if (report.isVerified) { 
                        const verifiedBadge = document.createElement('span'); verifiedBadge.textContent = ' ✔';
                        verifiedBadge.title = 'Skott verifierat'; verifiedBadge.style.color = 'var(--success-color)';
                        timeCellDesktop.appendChild(verifiedBadge);
                    }
                    primaryInfoDiv.appendChild(timeCellDesktop); // Läggs till, men CSS döljer på mobil

                    const passCellDesktop = document.createElement('div');
                    passCellDesktop.classList.add('report-cell', 'pass-location-cell');
                    passCellDesktop.textContent = report.felledGameDetails.passLocation || '-';
                    primaryInfoDiv.appendChild(passCellDesktop);

                    const meatCellDesktop = document.createElement('div');
                    meatCellDesktop.classList.add('report-cell', 'meat-dist-cell');
                    meatCellDesktop.textContent = report.felledGameDetails.meatDistribution || '-';
                    primaryInfoDiv.appendChild(meatCellDesktop);


                    // Åtgärder och expander-knapp
                    const actionsAndToggleDiv = document.createElement('div');
                    actionsAndToggleDiv.classList.add('actions-and-toggle');

                    const itemActionsDiv = document.createElement('div');
                    itemActionsDiv.classList.add('item-actions');

                    const editBtn = document.createElement('button');
                    editBtn.classList.add('icon-button', 'edit-game-btn');
                    editBtn.title = "Redigera Fällt Vilt";
                    editBtn.innerHTML = `<svg viewBox="0 0 24 24"><path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34a.9959.9959 0 00-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/></svg>`;
                    editBtn.onclick = () => openAddGameModal(report.id);

                    const deleteBtn = document.createElement('button'); 
                    deleteBtn.classList.add('icon-button', 'delete-btn');
                    deleteBtn.title = "Ta bort denna rapport";
                    deleteBtn.innerHTML = `<svg viewBox="0 0 24 24"><path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/></svg>`;
                    deleteBtn.onclick = () => handleDeleteLoggedShot(report.id); 

                    itemActionsDiv.appendChild(editBtn);
                    itemActionsDiv.appendChild(deleteBtn);
                    actionsAndToggleDiv.appendChild(itemActionsDiv);

                    const toggleBtn = document.createElement('button');
                    toggleBtn.classList.add('toggle-details-btn');
                    toggleBtn.setAttribute('aria-expanded', 'false');
                    toggleBtn.setAttribute('aria-controls', `secondary-info-${report.id}`);
                    toggleBtn.innerHTML = `<svg viewBox="0 0 24 24"><path d="M7.41 8.59L12 13.17l4.59-4.58L18 10l-6 6-6-6 1.41-1.41z"/></svg>`; // Pil nedåt
                    actionsAndToggleDiv.appendChild(toggleBtn);
                    
                    primaryInfoDiv.appendChild(actionsAndToggleDiv);
                    wrapper.appendChild(primaryInfoDiv);

                    // Sekundär info (dold by default)
                    const secondaryInfoDiv = document.createElement('div');
                    secondaryInfoDiv.classList.add('report-secondary-info');
                    secondaryInfoDiv.id = `secondary-info-${report.id}`;
                    secondaryInfoDiv.innerHTML = `
                        <p><strong>Skott-tid:</strong> ${report.shotTime || '-'}${report.isVerified ? ' (Verifierat ✔)' : ''}</p>
                        <p><strong>Pass/Plats:</strong> ${report.felledGameDetails.passLocation || '-'}</p>
                        <p><strong>Köttfördelning:</strong> ${report.felledGameDetails.meatDistribution || '-'}</p>
                    `;
                    wrapper.appendChild(secondaryInfoDiv);

                    toggleBtn.onclick = () => {
                        const isExpanded = toggleBtn.getAttribute('aria-expanded') === 'true';
                        toggleBtn.setAttribute('aria-expanded', !isExpanded);
                        secondaryInfoDiv.classList.toggle('visible');
                        toggleBtn.classList.toggle('expanded');
                    };
                    
                    reportListContainer.appendChild(wrapper);
                });
            }
        }
        
        // --- MODAL FÖR FÄLLT VILT (oförändrad) ---
        function openAddGameModal(shotLogId) { /* ... (din befintliga korrekta funktion) ... */ }
        function closeAddGameModal() { /* ... (din befintliga korrekta funktion) ... */ }
        function handleSaveGameDetails() { /* ... (din befintliga korrekta funktion) ... */ }
        
        // --- DATA EXPORT (oförändrad) ---
        function exportAllDataToCSV() { /* ... (din befintliga korrekta funktion) ... */ }

        // --- RENSA ALL DATA (oförändrad) ---
        function handleClearAllData() { /* ... (din befintliga korrekta funktion) ... */ }

        // --- OVERLAY HANTERING (oförändrad) ---
        function openHelpOverlay() { /* ... (din befintliga korrekta funktion) ... */ }
        function closeHelpOverlay() { /* ... (din befintliga korrekta funktion) ... */ }
        function generateQRCode() { /* ... (din befintliga korrekta funktion) ... */ }
        function openShareOverlay() { /* ... (din befintliga korrekta funktion) ... */ }
        function closeShareOverlay() { /* ... (din befintliga korrekta funktion) ... */ }
        function closeAllOverlays(keepOpenOverlay = null) { /* ... (din befintliga korrekta funktion) ... */ }
        function checkAndCloseBodyOverlay() { /* ... (din befintliga korrekta funktion) ... */ }

        // Kopiera in resten av dina fungerande JS-funktioner här för fullständighet.
        // Jag har lämnat platshållare för de funktioner som inte ändrades direkt av denna request.
        // Se till att funktionerna setupPWAInstallation, speech recognition, datahantering etc. finns med.
        // Exempel:
        function setupPWAInstallation() { /* ... din kod ... */ }
        function setupGenericSpeechRecognition(r,b,t) { /* ... din kod ... */ }
        function setupSpeechRecognitionForShooter() { /* ... din kod ... */ }
        function setupSpeechRecognitionForMeat() { /* ... din kod ... */ }
        function saveAllDataToLocalStorage() { /* ... din kod ... */ }
        function loadAllDataFromLocalStorage() { /* ... din kod ... */ }
        function handleLogShot() { /* ... din kod ... */ }
        function handleToggleShotVerification(id, el) { /* ... din kod ... */ }
        function handleDeleteLoggedShot(id) { /* ... din kod ... */ }
        function renderShotLogList() { /* ... din kod ... */ }
        function openAddGameModal(id) { /* ... din kod ... */ }
        function closeAddGameModal() { /* ... din kod ... */ }
        function handleSaveGameDetails() { /* ... din kod ... */ }
        function exportAllDataToCSV() { /* ... din kod ... */ }
        function handleClearAllData() { /* ... din kod ... */ }
        function openHelpOverlay() { /* ... din kod ... */ }
        function closeHelpOverlay() { /* ... din kod ... */ }
        function generateQRCode() { /* ... din kod ... */ }
        function openShareOverlay() { /* ... din kod ... */ }
        function closeShareOverlay() { /* ... din kod ... */ }
        function closeAllOverlays(k = null) { /* ... din kod ... */ }
        function checkAndCloseBodyOverlay() { /* ... din kod ... */ }

    </script>
</body>
</html>